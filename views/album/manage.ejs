<%- include('../partials/header') %>

<section class="card reveal section-head">
  <div class="row between">
    <div>
      <h1>Photo Management</h1>
      <p>사진 등록은 팝업에서 처리하고, 가족 계정은 모든 사진을 삭제할 수 있습니다.</p>
    </div>
    <button class="btn" type="button" data-open-photo-modal>새 사진 등록</button>
  </div>
</section>

<section class="insta-layout reveal">
  <aside class="insta-sidebar left card">
    <h3>Current Categories</h3>
    <div class="tag-wrap">
      <% categories.forEach((category) => { %>
        <span class="pill"><%= category.name %></span>
      <% }) %>
    </div>
  </aside>

  <main class="insta-feed">
    <% if (recentPhotos.length === 0) { %>
      <article class="card"><p class="muted">등록된 사진이 없습니다.</p></article>
    <% } %>

    <% recentPhotos.forEach((photo) => { %>
      <article class="insta-post card">
        <header class="insta-post-head">
          <div>
            <strong><%= photo.title %></strong>
            <span class="pill"><%= photo.category_name || 'Uncategorized' %></span>
          </div>
          <div class="post-head-actions">
            <small><%= photo.created_by || 'system' %></small>
            <form
              method="post"
              action="/album/manage/photos/<%= photo.id %>/delete"
              class="inline-delete-form"
              data-delete-form
              data-delete-label='사진 "<%= photo.title %>"'
            >
              <button
                class="icon-trash-btn"
                type="button"
                data-delete-trigger
                aria-label="Delete photo"
                title="삭제"
              >
                <svg viewBox="0 0 24 24" aria-hidden="true">
                  <path d="M9 3.75A1.75 1.75 0 0 1 10.75 2h2.5A1.75 1.75 0 0 1 15 3.75V5h3.25a.75.75 0 0 1 0 1.5H5.75a.75.75 0 0 1 0-1.5H9V3.75ZM10.5 5h3V3.75a.25.25 0 0 0-.25-.25h-2.5a.25.25 0 0 0-.25.25V5Zm-2 3a.75.75 0 0 1 .75.75v8a.75.75 0 0 1-1.5 0v-8A.75.75 0 0 1 8.5 8Zm3.5.75a.75.75 0 0 0-1.5 0v8a.75.75 0 0 0 1.5 0v-8Zm2.75-.75a.75.75 0 0 1 .75.75v8a.75.75 0 0 1-1.5 0v-8a.75.75 0 0 1 .75-.75ZM6 8.75A1.75 1.75 0 0 1 7.75 7h8.5A1.75 1.75 0 0 1 18 8.75V18a3 3 0 0 1-3 3H9a3 3 0 0 1-3-3V8.75Zm1.75-.25a.25.25 0 0 0-.25.25V18a1.5 1.5 0 0 0 1.5 1.5h6A1.5 1.5 0 0 0 16.5 18V8.75a.25.25 0 0 0-.25-.25h-8.5Z"/>
                </svg>
              </button>
            </form>
          </div>
        </header>

        <img class="insta-image" src="<%= photo.image_url %>" alt="<%= photo.title %>" loading="lazy" />

        <div class="insta-post-body">
          <p><%= photo.caption %></p>
        </div>
      </article>
    <% }) %>
  </main>

  <aside class="insta-sidebar right card">
    <h3>Rule</h3>
    <p class="muted">가족 계정은 모든 사진/글을 삭제할 수 있습니다.</p>
    <a class="btn ghost" href="/album">앨범 보기</a>
  </aside>
</section>

<dialog class="modal confirm-modal" id="deleteConfirmDialog">
  <div class="modal-content">
    <h2>삭제 확인</h2>
    <p class="muted" id="deleteConfirmMessage">이 항목을 삭제하시겠어요?</p>
    <div class="row confirm-actions">
      <button class="btn ghost" type="button" id="deleteCancelBtn">취소</button>
      <button class="btn danger" type="button" id="deleteConfirmBtn">확인</button>
    </div>
  </div>
</dialog>

<dialog class="modal" id="photoManageModal">
  <form method="post" action="/album/manage/photos" class="modal-content form" enctype="multipart/form-data">
    <div class="row between">
      <h2>Add Photo</h2>
      <button type="button" class="btn ghost small" data-close-photo-modal>닫기</button>
    </div>

    <div class="segmented">
      <button type="button" class="segment active" data-source-tab="url">URL 입력</button>
      <button type="button" class="segment" data-source-tab="upload">파일 업로드</button>
    </div>

    <input type="hidden" name="sourceType" value="url" id="photoSourceType" />

    <label>Photo Title <input name="title" required /></label>
    <label>Caption <input name="caption" /></label>

    <div id="photoUrlField">
      <label>Image URL <input name="imageUrl" /></label>
    </div>

    <div id="photoUploadField" class="hidden-block">
      <label>Image File <input name="photoFile" type="file" accept="image/*" /></label>
    </div>

    <label>Highlight Order <input name="highlightOrder" type="number" value="0" /></label>
    <button class="btn" type="submit">Upload + Auto Categorize</button>
  </form>
</dialog>

<script defer src="/js/delete-confirm.js"></script>
<script defer src="/js/album-manage.js"></script>

<%- include('../partials/footer') %>
