<%- include('../partials/header') %>

<section class="card reveal section-head">
  <div class="row between">
    <div>
      <h1>Blog Management</h1>
      <p>직접 작성/수정은 전용 페이지에서 진행하고, 가족 계정은 모든 글을 삭제할 수 있습니다.</p>
    </div>
    <a class="btn" href="/blog/manage/new">새 글 작성</a>
  </div>
</section>

<section class="insta-layout reveal blog-manage-layout">
  <aside class="insta-sidebar left card">
    <h3>내 작성글</h3>
    <% if (ownPosts.length === 0) { %>
      <p class="muted">아직 작성한 글이 없습니다.</p>
    <% } %>
    <ul class="project-list">
      <% ownPosts.forEach((post) => { %>
        <li>
          <a href="/blog/<%= post.slug %>"><%= post.title %></a>
          <a class="btn ghost small" href="/blog/manage/<%= post.id %>/edit">수정</a>
        </li>
      <% }) %>
    </ul>

    <div class="rule-block">
      <h3>Rule</h3>
      <p class="muted">수정은 작성자만 가능하고, 삭제는 가족 계정이면 누구 글이든 가능합니다.</p>
    </div>
  </aside>

  <main class="insta-feed">
    <% if (posts.length === 0) { %>
      <article class="card"><p class="muted">등록된 글이 없습니다.</p></article>
    <% } %>

    <% posts.forEach((post) => { %>
      <article class="insta-post card">
        <header class="insta-post-head">
          <div>
            <strong><a href="/blog/<%= post.slug %>"><%= post.title %></a></strong>
            <span class="pill">by <%= post.author %></span>
          </div>
          <div class="post-head-actions">
            <small><%= post.created_at %></small>
            <form
              method="post"
              action="/blog/manage/<%= post.id %>/delete"
              class="inline-delete-form"
              data-delete-form
              data-delete-label='블로그 글 "<%= post.title %>"'
            >
              <button
                class="icon-trash-btn"
                type="button"
                data-delete-trigger
                aria-label="Delete blog post"
                title="삭제"
              >
                <svg viewBox="0 0 24 24" aria-hidden="true">
                  <path d="M9 3.75A1.75 1.75 0 0 1 10.75 2h2.5A1.75 1.75 0 0 1 15 3.75V5h3.25a.75.75 0 0 1 0 1.5H5.75a.75.75 0 0 1 0-1.5H9V3.75ZM10.5 5h3V3.75a.25.25 0 0 0-.25-.25h-2.5a.25.25 0 0 0-.25.25V5Zm-2 3a.75.75 0 0 1 .75.75v8a.75.75 0 0 1-1.5 0v-8A.75.75 0 0 1 8.5 8Zm3.5.75a.75.75 0 0 0-1.5 0v8a.75.75 0 0 0 1.5 0v-8Zm2.75-.75a.75.75 0 0 1 .75.75v8a.75.75 0 0 1-1.5 0v-8a.75.75 0 0 1 .75-.75ZM6 8.75A1.75 1.75 0 0 1 7.75 7h8.5A1.75 1.75 0 0 1 18 8.75V18a3 3 0 0 1-3 3H9a3 3 0 0 1-3-3V8.75Zm1.75-.25a.25.25 0 0 0-.25.25V18a1.5 1.5 0 0 0 1.5 1.5h6A1.5 1.5 0 0 0 16.5 18V8.75a.25.25 0 0 0-.25-.25h-8.5Z"/>
                </svg>
              </button>
            </form>
          </div>
        </header>

        <% if (post.cover_image) { %>
          <img class="insta-image" src="<%= post.cover_image %>" alt="<%= post.title %>" loading="lazy" />
        <% } %>

        <div class="insta-post-body">
          <p><%= post.summary %></p>
          <% if (post.author === currentFamilyName) { %>
            <div class="row">
              <a class="btn ghost small" href="/blog/manage/<%= post.id %>/edit">수정</a>
            </div>
          <% } %>
        </div>
      </article>
    <% }) %>
  </main>
</section>

<dialog class="modal confirm-modal" id="deleteConfirmDialog">
  <div class="modal-content">
    <h2>삭제 확인</h2>
    <p class="muted" id="deleteConfirmMessage">이 항목을 삭제하시겠어요?</p>
    <div class="row confirm-actions">
      <button class="btn ghost" type="button" id="deleteCancelBtn">취소</button>
      <button class="btn danger" type="button" id="deleteConfirmBtn">확인</button>
    </div>
  </div>
</dialog>

<script defer src="/js/delete-confirm.js"></script>

<%- include('../partials/footer') %>
